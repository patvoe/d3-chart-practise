<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SVG with D3</title>
    <link rel="stylesheet" href="base.css" />
    <link rel="stylesheet" href="custom.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Suez+One&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
      /* Add some basic styles for the tooltip */
      .tooltip {
        position: absolute;
        background-color: #fff;
        border: 1px solid #f4f4f4;
        border-radius: 5px;
        padding: 5px;
        box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.2s;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
      }
    </style>
    <script>
      // Step 4. load your data with d3.csv()
      d3.csv("steps.csv").then((data) => {
        // check if the data is loaded:
        console.log(data);

        // == your code happens below ==

        // Step 5. create an SVG container inside #my-svg-chart using d3.select().append()
        const myChart = d3
          .select("#my-svg-chart")
          .append("svg")
          .attr("width", 640)
          .attr("height", 640);

        // Step 6. create SVG elements binded with data
        const individualCharts = myChart
          .selectAll("circle")
          .data(data)
          .join("circle");

        // Define a list of yellow tones
        const yellowTones = [
          "#FFE462",
          "#FFD364",
          "#FFCC80",
          "#FFB74D",
          "#FFA726",
          "#FF9800",
          "#FB8C00",
          "#F57C00",
          "#EF6C00",
          "#E65100",
          "#BF360C",
        ];
        // Step 7. Position the SVG shapes at the right places
        const gridSize = 50,
          gap = 2;

        individualCharts
          .attr("cx", (d, i) => {
            return (i % 10) * (gridSize + gap) + gridSize / 2;
          })
          .attr("cy", (d, i) => {
            return Math.floor(i / 10) * (gridSize + gap) + gridSize / 2;
          })
          .attr("r", (d) => {
            if (d.Category == "0-2500") {
              return 1 * 2.5;
            } else if (d.Category == "2501-5000") {
              return 2 * 2.5;
            } else if (d.Category == "5001-7500") {
              return 3 * 2.5;
            } else if (d.Category == "7501-10000") {
              return 4 * 2.5;
            } else if (d.Category == "10001-12500") {
              return 5 * 2.5;
            } else if (d.Category == "12501-15000") {
              return 6 * 2.5;
            } else if (d.Category == "15001-17500") {
              return 7 * 2.5;
            } else if (d.Category == "17501-20000") {
              return 8 * 2.5;
            } else if (d.Category == "20001-22500") {
              return 9 * 2.5;
            } else if (d.Category == "22501-25000") {
              return 10 * 2.5;
            } else if (d.Category == "> 25000") {
              return 11 * 2.5;
            } else {
              return 0;
            }
          })
          .style("fill", (d) => {
            // Use the index of the category to get the corresponding color from the list
            const categoryIndex = [
              "0-2500",
              "2501-5000",
              "5001-7500",
              "7501-10000",
              "10001-12500",
              "12501-15000",
              "15001-17500",
              "17501-20000",
              "20001-22500",
              "22501-25000",
              "> 25000",
            ].indexOf(d.Category);

            return yellowTones[categoryIndex];
          });

        // Step 9. Tooltips
        const tooltip = d3.select("#tooltip");

        individualCharts
          .on("mousemove", function (event, d) {
            tooltip
              .style("left", event.pageX + 10 + "px")
              .style("top", event.pageY - 20 + "px")
              .style("opacity", 1)
              .text(`${d.Schritte.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} steps ðŸš¶`);
          })
          .on("mouseout", function (d) {
            tooltip.style("opacity", 0);
          });

        // Add hover effect
        individualCharts
          .on("mouseover", function (event, d) {
            d3.select(this).attr("stroke", "#121212").attr("stroke-width", 2);
          })
          .on("mouseout", function (event, d) {
            d3.select(this).attr("stroke", "none");
          });
      });
    </script>
  </head>
  <body>
    <h1>Daily steps I have taken since May 1</h1>
    <p>My daily steps since May 1</p>
    <div id="my-svg-chart"></div>
    <div class="tooltip" id="tooltip"></div>
  </body>
</html>
